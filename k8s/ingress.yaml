---
# BFF Ingress Configuration - PRODUCTION
# Using app.goalixa.com for production with path-based routing
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: bff-ingress
  namespace: goalixa-bff
  annotations:
    # Traefik specific annotations
    traefik.ingress.kubernetes.io/router.entrypoints: web
    traefik.ingress.kubernetes.io/router.priority: "200"

spec:
  ingressClassName: traefik
  # TLS - enable when certificate is ready
  # tls:
  # - hosts:
  #   - app.goalixa.com
  #   secretName: app-bff-tls
  rules:
  - host: app.goalixa.com  # Production domain
    http:
      paths:
      # BFF API endpoints at /bff path
      - path: /bff
        pathType: Prefix
        backend:
          service:
            name: bff-service
            port:
              number: 8000

---
# Traefik Middleware for CORS
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: bff-cors
  namespace: goalixa-bff
spec:
  headers:
    accessControlAllowMethods:
      - GET
      - POST
      - PUT
      - DELETE
      - PATCH
      - OPTIONS
    accessControlAllowHeaders:
      - Authorization
      - Content-Type
      - X-Requested-With
      - Accept
      - Origin
    accessControlAllowOriginList:
      - https://app.goalixa.com
      - https://pwa.goalixa.com
      - https://www.goalixa.com
    accessControlMaxAge: 100
    addVaryHeader: true

